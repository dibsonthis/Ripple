import requests
import io

println("\nWelcome to the client side of the queue example!\nEntering input in here will add to the queue on the server, however only valid input will be processed.\n\nOur queueing system will by default batch 5 tasks and then process them all at once. You can change the batch limit like so: L 3 (this will set the batch limit to 3). Setting it to 0 means no batching is done and tasks are processed as they are added to queue.\n\nValid input:\n1: prints the queue\n-1: adds an exit event to the queue\n-2: immediately exits\n69: ummm\nL <number>: sets the batch limit")

while (true) {
	print("\nInput: ")
	const input = io.input()
	const response = requests.post("localhost:1234", "/queue", {data: input})
	if (response.status != 200) {
		println("Server not responding - exiting")
		break
	}
	const data = response.toJson().data
	if (data == "exit") {
		println("Exit event reached - exiting")
		break
	}
	if (data == "limit_change") {
		println("Successfully changed limit")
	} else if (data == "limit_change_error") {
		println("Invalid limit")
	}
}

requests.post("localhost:1234", "/exit")